<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Playground</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 300px 1fr;
            grid-template-rows: 60px 1fr;
            grid-template-areas: 
                "sidebar header"
                "sidebar main";
            height: 100vh;
            background: #fff;
            margin: 20px;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            grid-area: header;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            border-bottom: 1px solid #e0e6ed;
        }

        .logo {
            font-size: 18px;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo::before {
            content: "üêç";
            font-size: 20px;
        }

        .header-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            color: #495057;
        }

        .sidebar {
            grid-area: sidebar;
            background: #f8f9fa;
            border-right: 1px solid #e0e6ed;
            padding: 20px 0;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 20px 15px;
            border-bottom: 1px solid #e0e6ed;
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .sidebar-subtitle {
            font-size: 12px;
            color: #6c757d;
            font-weight: 400;
        }

        .program-list {
            list-style: none;
        }

        .program-item {
            margin-bottom: 2px;
        }

        .program-btn {
            width: 100%;
            text-align: left;
            padding: 12px 20px;
            background: none;
            border: none;
            color: #495057;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-family: inherit;
        }

        .program-btn:hover {
            background: #e9ecef;
            color: #2c3e50;
        }

        .program-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .program-btn.active::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #fff;
        }

        .main {
            grid-area: main;
            display: flex;
            flex-direction: column;
            background: #fff;
        }

        .editor-header {
            padding: 15px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e6ed;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .editor-title {
            font-size: 14px;
            color: #6c757d;
            font-weight: 600;
        }

        .editor-info {
            font-size: 12px;
            color: #6c757d;
        }

        .editor-container {
            flex: 1;
            position: relative;
            padding: 30px;
        }

        .editor {
            width: 100%;
            height: 100%;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
            background: #fafbfc;
            color: #2c3e50;
            transition: border-color 0.2s ease;
        }

        .editor:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .status-bar {
            padding: 10px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e0e6ed;
            font-size: 12px;
            color: #6c757d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .loading {
            display: none;
            align-items: center;
            gap: 8px;
            color: #667eea;
        }

        .loading.show {
            display: flex;
        }

        .spinner {
            width: 12px;
            height: 12px;
            border: 2px solid #e0e6ed;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                grid-template-columns: 1fr;
                grid-template-rows: 60px auto 1fr;
                grid-template-areas: 
                    "header"
                    "sidebar"
                    "main";
            }

            .sidebar {
                max-height: 200px;
                border-right: none;
                border-bottom: 1px solid #e0e6ed;
            }

            .program-list {
                display: flex;
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .program-item {
                margin-bottom: 0;
                margin-right: 2px;
                min-width: 200px;
            }
        }

        /* Syntax highlighting placeholder */
        .editor {
            tab-size: 4;
        }

        /* Success/Error Messages */
        .message-popup {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 18px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            opacity: 0;
            /* Explicit smooth transitions for a natural feel */
            transition: transform 0.35s cubic-bezier(0.2,0.8,0.2,1),
                        opacity 0.35s ease,
                        border-color 0.25s ease,
                        background-color 0.25s ease,
                        color 0.25s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center; /* center content horizontally */
            text-align: center; /* center any text */
            gap: 10px;
            min-width: 250px;
            background: #f8f9fa; /* Grey-white background */
            color: #2c3e50; /* Dark text color */
            border: 2px solid transparent;
            min-height: 52px; /* prevent height collapse when inner content swaps */
        }

        .message-popup.show {
            transform: translateX(0);
            opacity: 1;
        }

        .message-popup.success {
            border-color: #28a745;
            color: #28a745;
        }

        .message-popup.error {
            border-color: #dc3545;
            color: #dc3545;
        }

        .message-popup.irrelevant {
            border-color: #ff8c00; /* orange */
            color: #ff8c00;
        }

        .message-popup.checking {
            border-color: #ff8c00; /* stronger orange */
        }

        /* Ensure no pseudo-element icon is applied to message-popup (prevents duplicate icons) */
        .message-popup::before {
            content: none !important;
            display: none !important;
        }

        .toast-icon {
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 18px;
        }

        .toast-content {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            opacity: 1;
            transition: opacity 0.22s ease;
            min-height: 24px; /* keep space during fade */
            min-width: 80px; /* smaller for single-word messages */
        }

        .pulsing-dot {
            width: 10px;
            height: 10px;
            background-color: #ff8c00; /* stronger orange */
            border-radius: 50%;
            /* pulse uses box-shadow animation only */
            animation: pulse 1.6s infinite ease-in-out;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 140, 0, 0.9);
            }
            60% {
                box-shadow: 0 0 0 12px rgba(255, 140, 0, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 140, 0, 0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">Python Playground</div>
            <div class="header-buttons">
                <button class="btn btn-secondary" onclick="clearEditor()">Clear</button>
                <button class="btn btn-primary" onclick="checkCode()">Check Code</button>
            </div>
        </header>

        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title" style="text-align: center;">Programs</div>
            </div>
            <ul class="program-list">
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Greatest Of Three Numbers')">
                        Greatest Of Three Numbers
                    </button>
                </li>
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Character Classifier')">
                        Character Classifier
                    </button>
                </li>
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Generating Electricity Bill')">
                        Generating Electricity Bill
                    </button>
                </li>
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Histogram of Random Data')">
                        Histogram of Random Data
                    </button>
                </li>
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Line Graph - Temperature')">
                        Line Graph - Temperature
                    </button>
                </li>
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Mean, Median and Mode')">
                        Mean, Median and Mode
                    </button>
                </li>
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Multiplication Table')">
                        Multiplication Table
                    </button>
                </li>
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Pie Chart - Student Preferences')">
                        Pie Chart - Student Preferences
                    </button>
                </li>
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Range of Data')">
                        Range of Data
                    </button>
                </li>
                <li class="program-item">
                    <button class="program-btn" onclick="selectProgram(this, 'Right-Angle Star Pyramid')">
                        Right-Angle Star Pyramid
                    </button>
                </li>
            </ul>
        </aside>

        <main class="main">
            <div class="editor-header">
                <div class="editor-title" id="currentProgram">Select a program to begin coding</div>
                <div class="editor-info">Python 3.x</div>
            </div>
            <div class="editor-container">
                <textarea 
                    class="editor" 
                    id="codeEditor"
                    placeholder="Write your Python code here..."
                    spellcheck="false"
                ></textarea>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <span>Ready</span>
                </div>
                <div class="loading" id="loadingIndicator">
                    <div class="spinner"></div>
                    <span>Checking code...</span>
                </div>
                <div class="status-item">
                    <span>Lines: <span id="lineCount">1</span></span>
                </div>
            </div>
        </main>
    </div>

    <script>
        let currentProgram = null;
        const MISTRAL_API_KEY = 'KzYqLADgPHMT4zkx9oYc8CK5wccjrigx'; // Replace with actual API key

        // Program selection
        function selectProgram(button, programName) {
            // Save current code before switching
            if (currentProgram) {
                const prevCode = document.getElementById('codeEditor').value;
                localStorage.setItem('code_' + currentProgram, prevCode);
            }
            // Remove active class from all buttons
            document.querySelectorAll('.program-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // Add active class to clicked button
            button.classList.add('active');
            // Update current program
            currentProgram = programName;
            document.getElementById('currentProgram').textContent = programName;
            // Load saved code if exists, else blank
            const savedCode = localStorage.getItem('code_' + programName) || '';
            document.getElementById('codeEditor').value = savedCode;
            updateLineCount();
        }

        // Clear editor
        function clearEditor() {
            if (confirm('Are you sure you want to clear ALL saved programs from the editor?')) {
                document.getElementById('codeEditor').value = '';
                // Remove all program codes from localStorage
                Object.keys(localStorage).forEach(function(key) {
                    if (key.startsWith('code_')) {
                        localStorage.removeItem(key);
                    }
                });
                updateLineCount();
            }
        }

        // Save code
        function saveCode() {
            const code = document.getElementById('codeEditor').value;
            const program = currentProgram || 'untitled';
            
            if (!code.trim()) {
                alert('No code to save!');
                return;
            }
            
            // Create download
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${program.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.py`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        let toastTimeout;

        // Check code with Mistral API
        async function checkCode() {
            if (window._checkingCode) {
                return;
            }
            window._checkingCode = true;
            const code = document.getElementById('codeEditor').value;
            
            if (!code.trim()) {
                alert('Please enter some code to check!');
                return;
            }

            if (MISTRAL_API_KEY === 'YOUR_MISTRAL_API_KEY_HERE') {
                alert('Please configure your Mistral API key in the code!');
                return;
            }

            // Show loading indicator and checking message
            document.getElementById('loadingIndicator').classList.add('show');
            document.querySelector('.status-bar .status-item span').textContent = 'Checking...';
            showCheckingMessage();

            try {
                    const programName = currentProgram || 'untitled';
                    const programAims = {
                        'Greatest Of Three Numbers': 'The aim of this project is to find the greatest of 3 given numbers.',
                        'Multiplication Table': 'The aim of this project is to return the multiplication table of the given number up to 12.',
                        'Character Classifier': 'To classify a user-inputted character as an uppercase letter, lowercase letter, or a special character/digit.',
                        'Right-Angle Star Pyramid': 'The aim of this project is to generate a forward and backward right-angled triangle pattern of asterisks (*) based on the number of rows specified by the user. Each row contains an increasing number of asterisks, starting from one and increasing up to the given number of rows.',
                        'Generating Electricity Bill': 'To calculate the monthly electricity bill based on the number of units consumed using a tiered pricing system. The program applies different rates for different consumption levels and includes a fixed charge based on usage.',
                        'Mean, Median and Mode': "To calculate the statistical measures ‚Äî mean, median, and mode ‚Äî of a given set of numerical data entered by the user. The program uses Python's statistics module to perform these computations. It allows the user to input values as space-separated numbers, processes them into a list, and calculates the central tendency metrics accordingly.",
                        'Histogram of Random Data': 'To generate a set of 50 random integers between 1 and 100 and represent their distribution using a histogram. The program uses Python\'s random module to generate the data and the matplotlib library to plot the histogram. The histogram visually shows how the generated values are spread across defined intervals (bins).',
                        'Pie Chart ‚Äì Student Preferences': 'To visualize the preferences of students for different school subjects using a pie chart. The program uses the matplotlib library to represent the number of students preferring each subject. This provides a clear, proportional view of how interests are distributed among subjects.',
                        'Line Graph ‚Äì Temperature': 'To plot a line graph showing the change in temperature across the days of a week. The program uses Python‚Äôs matplotlib library to visualize temperature data over time, helping to observe trends or fluctuations in daily weather.',
                        'Range of Data': 'To calculate the range of a given set of numerical data. The program processes them into a list, and calculates the range accordingly.'
                    };
                    let aim = programAims[programName] || '';
                    let prompt = '';
                    if (aim) {
                        prompt = `You are an expert Python code analysis assistant. The aim of the program is: "${aim}". For the code below, return ONLY this JSON: {"relevance": "Relevant" or "Irrelevant", "correctness": "Correct" or "Incorrect"}.\n- Mark relevance "Irrelevant" if the code does not directly solve the aim, even if syntactically correct.\n- Mark correctness "Incorrect" if there are ANY syntax or runtime errors.\n- Otherwise, mark as "Relevant" and "Correct" if the code is syntactically correct and logically fulfills the aim. Do not provide any explanation whatsoever; Only return the raw JSON.\nCode:\n${code}`;
                    } else {
                        prompt = `You are an expert Python code analysis assistant. The aim of the program is: "${aim}". For the code below, return ONLY this JSON: {"relevance": "Relevant" or "Irrelevant", "correctness": "Correct" or "Incorrect"}.\n- Mark relevance "Irrelevant" if the code does not directly solve the aim, even if syntactically correct.\n- Mark correctness "Incorrect" if there are ANY syntax or runtime errors.\n- Otherwise, mark as "Relevant" and "Correct" if the code is syntactically correct and logically fulfills the aim. Do not provide any explanation whatsoever; Only return the raw JSON.\nCode:\n${code}`;
                    }
                    const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${MISTRAL_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: 'mistral-small',
                            messages: [{
                                role: 'user',
                                content: prompt
                            }],
                            max_tokens: 500
                        })
                    });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const feedback = data.choices[0].message.content.trim();
                console.log('AI raw feedback:', feedback);

                // Try to parse strict JSON from the model: { relevance, correctness, explanation }
                let relevance = null;
                let correctness = null;
                try {
                    const parsed = JSON.parse(feedback);
                    relevance = (parsed.relevance || '').toString().trim().toLowerCase();
                    correctness = (parsed.correctness || '').toString().trim().toLowerCase();
                } catch (jsonErr) {
                    // fallback: try loose parsing and keep only the first tokens
                    console.warn('Failed to parse JSON from model, falling back to token parsing.', jsonErr);
                    const tokens = feedback.split(/[\s:\-\n]+/).filter(Boolean);
                    relevance = (tokens[0] || '').toLowerCase();
                    correctness = (tokens[1] || '').toLowerCase();
                }

                // Normalize possible values
                const isRelevant = relevance.toLowerCase() === 'relevant';
                const isIrrelevant = relevance.toLowerCase() === 'irrelevant';
                const isCorrect = correctness.toLowerCase() === 'correct';
                const isIncorrect = correctness.toLowerCase() === 'incorrect';

                // Map to toast states:
                // New logic: incorrect (syntax/runtime errors) > irrelevant > correct
                if (isIncorrect) {
                    updateMessage('Wrong', 'error');
                } else if (isCorrect && isRelevant) {
                    updateMessage('Correct', 'success');
                } else if (isCorrect && !isRelevant) {
                    updateMessage('Irrelevant', 'irrelevant');
                } else {
                    updateMessage('Error', 'error');
                    console.log('Unclear AI response (full):', feedback);
                }

            } catch (error) {
                console.error('Error:', error);
                updateMessage('Error', 'error');
            } finally {
                // Hide loading indicator
                document.getElementById('loadingIndicator').classList.remove('show');
                document.querySelector('.status-bar .status-item span').textContent = 'Ready';
                window._checkingCode = false;
            }
        }

        // Update line count
        function updateLineCount() {
            const editor = document.getElementById('codeEditor');
            const lines = editor.value.split('\n').length;
            document.getElementById('lineCount').textContent = lines;
        }

        function showCheckingMessage() {
            clearTimeout(toastTimeout);
            const existingMessage = document.querySelector('.message-popup');
            if (existingMessage) {
                existingMessage.remove();
            }

            const message = document.createElement('div');
            message.id = 'toast-message';
            message.className = 'message-popup checking show';
            const content = document.createElement('div');
            content.className = 'toast-content';

            const dot = document.createElement('div');
            dot.className = 'pulsing-dot';

            const text = document.createElement('span');
            text.className = 'toast-text checking-text';
            text.textContent = 'Verifying code...';

            content.appendChild(dot);
            content.appendChild(text);
            message.appendChild(content);
            
            document.body.appendChild(message);
        }

        function svgIcon(type) {
            if (type === 'success') {
                return `
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="#28a745" stroke-width="2" fill="none" />
                        <path d="M7 12l3 3 7-7" stroke="#28a745" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>`;
            } else if (type === 'error') {
                return `
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="#dc3545" stroke-width="2" fill="none" />
                        <path d="M9 9l6 6M15 9l-6 6" stroke="#dc3545" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>`;
            }
            else if (type === 'irrelevant') {
                return `
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="#ff8c00" stroke-width="2" fill="none" />
                        <path d="M9.5 9.5l5 5M14.5 9.5l-5 5" stroke="#ff8c00" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>`;
            }
            return '';
        }

        function updateMessage(text, type) {
            clearTimeout(toastTimeout);
            let message = document.getElementById('toast-message');
            if (!message) {
                // create a fresh message container if it was removed by a previous timeout
                message = document.createElement('div');
                message.id = 'toast-message';
                message.className = `message-popup ${type} show`;
                const content = document.createElement('div');
                content.className = 'toast-content';

                const iconWrap = document.createElement('span');
                iconWrap.className = 'toast-icon';
                iconWrap.innerHTML = svgIcon(type);

                const textNode = document.createElement('span');
                textNode.className = 'toast-text';
                textNode.textContent = text;

                content.appendChild(iconWrap);
                content.appendChild(textNode);
                message.appendChild(content);
                document.body.appendChild(message);
                // schedule removal below as usual
            } else {
                // update border/color class quickly
                message.className = `message-popup ${type} show`;
            }

            // update border color quickly
            message.className = `message-popup ${type} show`;

            // fade out inner content then replace using DOM APIs (avoid innerHTML parsing duplicates)
            const inner = message.querySelector('.toast-content');
            if (inner) {
                inner.style.opacity = '0';
                setTimeout(() => {
                    // remove all children
                    while (inner.firstChild) inner.removeChild(inner.firstChild);

                    // create icon container
                    const iconWrap = document.createElement('span');
                    iconWrap.className = 'toast-icon';
                    iconWrap.innerHTML = svgIcon(type);

                    // create text node
                    const textNode = document.createElement('span');
                    textNode.className = 'toast-text';
                    textNode.textContent = text;

                    inner.appendChild(iconWrap);
                    inner.appendChild(textNode);
                    inner.style.opacity = '1';
                }, 220);
            } else {
                const content = document.createElement('div');
                content.className = 'toast-content';

                const iconWrap = document.createElement('span');
                iconWrap.className = 'toast-icon';
                iconWrap.innerHTML = svgIcon(type);

                const textNode = document.createElement('span');
                textNode.className = 'toast-text';
                textNode.textContent = text;

                content.appendChild(iconWrap);
                content.appendChild(textNode);
                message.appendChild(content);
            }

            // Hide message after 4 seconds with fade-only (opacity)
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => {
                // fade out by opacity only
                message.style.opacity = '0';
                // keep transform as-is (no sliding)
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 420); // slightly longer than CSS opacity transition
            }, 4000);
        }

        // Add event listeners
        document.getElementById('codeEditor').addEventListener('input', updateLineCount);
        // Save code to localStorage on input
        document.getElementById('codeEditor').addEventListener('input', function() {
            if (currentProgram) {
                localStorage.setItem('code_' + currentProgram, this.value);
            }
        });
        
        // Tab key support for proper indentation
        document.getElementById('codeEditor').addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = this.selectionStart;
                const end = this.selectionEnd;
                
                // Insert tab at cursor position
                this.value = this.value.substring(0, start) + '    ' + this.value.substring(end);
                
                // Move cursor after the inserted tab
                this.selectionStart = this.selectionEnd = start + 4;
            }
        });

        // Initialize
        updateLineCount();
    </script>
</body>
</html>